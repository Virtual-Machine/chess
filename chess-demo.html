<!DOCTYPE html>
<html>
	<head>
  		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
  		<title> - Project - </title>
		
		<style>#board,#sidePanel{height:600px;padding:0}#sidePanel,.moveListPanel{position:absolute;top:20px}#bYourTurn,#pieceWindow{visibility:hidden}#pieceWindow,#sidePanel,.holder{text-align:center}body,html{height:100%;margin:0;background-color:#222;overflow-y:hidden}#board{width:600px;background-color:#1B5658}#sidePanel{left:620px;width:300px;background-color:#444}.moveListPanel{left:940px;height:560px;width:220px;background-color:#333;padding:20px;font-family:Verdana}.moveList{height:500px;color:#eee;overflow-y:scroll}.playerBlack{background-color:#111;color:#ddd;height:287px}.playerWhite{background-color:#ddd;color:#111;height:287px}#bYourTurn,#wYourTurn{color:#D6812D;font-size:20px}.container{padding-top:20px;position:relative;height:100%;max-width:1200px;margin:0 auto}.cell{float:left;width:12.5%;height:12.5%}.holder{width:100%;height:100%;font-size:40px;line-height:75px;z-index:5}.light{background-color:#649877}.white{color:#eee}.black{color:#111}#pieceWindow{position:absolute;left:0;right:0;top:0;bottom:0;margin:auto;width:200px;height:200px;background-color:#aaa;line-height:100px;border-radius:20px}.button{cursor:pointer;font-size:20px;background-color:#080;width:100px;margin-left:50px;margin-top:25px;line-height:50px;height:50px}#colorDisplay,#secondaryDisplay,#themePicker{position:absolute;left:0;right:0;top:0;bottom:0;height:300px;margin:auto;text-align:center;border-radius:20px;visibility:hidden}.button:hover{background-color:#050;color:#777}.glow{background-color:rgba(153,181,97,.5)}.check{background-color:rgba(153,25,25,.5)}#gameBanner{font-size:24px;color:#009a00;margin:0 auto;width:90%;background-color:#000;border-radius:20px;padding:18px}#themePicker{width:200px;background-color:#aaa;line-height:20px}.themeEditorButton{color:#eee;font-family:Verdana;position:absolute;background-color:#555;width:100px;bottom:0;right:0;cursor:pointer}#acceptColor,#closeResultsButton{margin-top:20px;color:#fff;padding-top:10px;padding-bottom:10px}#chooseWhite,.themeEditorButton:hover{background-color:#333}#headerText{color:#D6812D}#colorDisplay,#secondaryDisplay{width:300px;background-color:#666;font-size:25px}#chooseBlack,#chooseWhite{font-size:50px;cursor:pointer}#chooseWhite{margin-top:20px;color:#ddd}#chooseWhite:hover{background-color:#111}#chooseBlack{color:#111;background-color:#bbb}#chooseBlack:hover{background-color:#ddd}#acceptColor{background-color:green;cursor:pointer}#acceptColor:hover{background-color:#0a0}.drawButton{visibility:hidden;background-color:#008;color:#ddd;width:100px;height:25px;padding:10px;border-radius:10px;cursor:pointer;margin:40px auto}.drawButton:hover{background-color:#00b}#drawOffer,#offerResults{position:absolute;left:0;right:0;top:0;bottom:0;width:300px;background-color:#666;visibility:hidden;margin:auto;text-align:center;border-radius:20px}#drawOffer{height:300px;font-size:25px}#acceptOffer,#declineOffer{color:#ddd;font-size:50px;cursor:pointer}#acceptOffer{background-color:#080}#acceptOffer:hover{background-color:#0b0}#declineOffer{margin-top:20px;background-color:#800}#declineOffer:hover{background-color:#b00}#offerResults{height:200px;font-size:25px}#closeResultsButton{background-color:green;cursor:pointer}</style>
	</head>
	<body>
		<div class="container">
			<div id="board">
			</div>
			<div id="sidePanel">
			<div class="playerBlack">
				<br>
				<div>Black</div>
				<br>
				<label for="bName">Name: </label><input id='bName' type="text">
				<br>
				<br>
				<label for="bName">Piece Value: </label><span id="bPieceValue"></span>
				<br>
				<br>
				<span id="bYourTurn">Your Turn!</span>
				<br>
				<div id="offerDrawBlack" class='drawButton' onclick='sendDrawOffer()'>Offer Draw</div>
			</div>
			<div class="playerWhite">
				<br>
				<div>White</div>
				<br>
				<label for="wName">Name: </label><input id='wName' type="text">
				<br>
				<br>
				<label for="wName">Piece Value: </label><span id="wPieceValue"></span>
				<br>
				<br>
				<span id="wYourTurn">Your Turn!</span>
				<br>
				<div id="offerDrawWhite" class='drawButton' onclick='sendDrawOffer()'>Offer Draw</div>
			</div>
			<div class="themeEditorButton" onclick="$('#themePicker').css('visibility', 'visible')">UI &#9881
			</div>
			</div>
			<div class="moveListPanel">
			<p id="headerText">Move List</p>
			<div class="moveList">
			</div>
			</div>
			<div id='gameBanner'>Game Status: In Game</div>
		</div>
		<div id="pieceWindow">
			<label for="piece">Select Piece</label><select name="piece" id="pieceSelect">
				<option value="Knight">Knight</option>
				<option value="Bishop">Bishop</option>
				<option value="Rook">Rook</option>
				<option value="Queen">Queen</option>
			</select>
			<div class="button" onclick="submitValue()">OK</div>
		</div>
		<div id="themePicker">
			<label for="html5colorpicker1">Black: </label><input type="color" id="html5colorpicker1" onchange="changeTheme1()" value="#000000" style="width:85%;">
			<label for="html5colorpicker2">White: </label><input type="color" id="html5colorpicker2" onchange="changeTheme2()" value="#ffffff" style="width:85%;">
			<label for="html5colorpicker3">Dark: </label><input type="color" id="html5colorpicker3" onchange="changeTheme3()" value="#1B5658" style="width:85%;">
			<label for="html5colorpicker4">Light: </label><input type="color" id="html5colorpicker4" onchange="changeTheme4()" value="#649877" style="width:85%;">
			<div class="button" onclick="hideThemePicker()">OK</div>
		</div>
		<div id="colorDisplay">
			<p>Black Or White?</p>
			<div id="chooseBlack" onclick="requestColor('Black')">♞ Black</div>
			<div id="chooseWhite" onclick="requestColor('White')">♞ White</div>
		</div>
		<div id="secondaryDisplay">
			<p>You are connected and playing as:</p>
			<div id="givenColor"></div>
			<div id="acceptColor" onclick="$('#secondaryDisplay').css('visibility', 'hidden')">Ok</div>
		</div>
		<div id="drawOffer">
			<p>Your opponent is offering a draw:</p>
			<div id="acceptOffer" onclick="acceptOffer()">Accept</div>
			<div id="declineOffer" onclick="declineOffer()">Decline</div>
		</div>
		<div id="offerResults">
			<p id='resultText'></p>
			<div id="closeResultsButton" onclick="$('#offerResults').css('visibility', 'hidden')">Ok</div>
		</div>
		
		
		
		
		
		
		
		
		
		<script>"use strict";function idToPiece(t){if(null==t)return null;var e=t[0];switch(e="w"===e?"White":"Black",t=t[1]){case"♟":return new Pawn(e);case"♜":return new Rook(e);case"♞":return new Knight(e);case"♝":return new Bishop(e);case"♛":return new Queen(e);case"♚":return new King(e)}}function mapToLetter(t){return letters[t]}function mapToValue(t){return letters.indexOf(t)}function getPieceAtCoords(t){if(positions[t]){var e=positions[t][1];return"w"==positions[t][0]?"<div id='"+t+"' class='holder white'>"+e+"</div>":"<div id='"+t+"' class='holder black'>"+e+"</div>"}return"<div id='"+t+"' class='holder'></div>"}function initializeMapping(){for(var t=0,e=8;e>0;e--)for(var i=1;9>i;i++)coordMap[t++]=mapToLetter(i)+""+e}function initializeBoard(){for(var t=0,e=!1,i=0;64>i;i++)++t>8&&(t=1,e=!e),e=!e,e?$("#board").append("<div class='cell light'>"+getPieceAtCoords(coordMap[i])+"</div>"):$("#board").append("<div class='cell'>"+getPieceAtCoords(coordMap[i])+"</div>")}function cellContents(t,e){return t[e].content?t[e].content.color:null}function explain(t){}function objectInCells(t,e){for(var i in e)if(t[e[i]].content)return!0;return!1}function cellsBetween(t,e,i){var n=[],s=["","a","b","c","d","e","f","g","h",""],r=getMovementShape(e,i),o=s.indexOf(e[0]),a=parseInt(e[1]),l=r[0],h=r[1];if(l>1||-1>l||h>1||-1>h){if(0===h)if(l>0)for(l;l>1;l--)n.push(s[++o]+a);else for(l;-1>l;l++)n.push(s[--o]+a);if(0===l)if(h>0)for(h;h>1;h--)n.push(s[o]+ ++a);else for(h;-1>h;h++)n.push(s[o]+--a);if(Math.abs(l)===Math.abs(h)){if(l>0&&h>0)for(l;l>1;l--)n.push(s[++o]+ ++a);if(0>l&&h>0)for(h;h>1;h--)n.push(s[--o]+ ++a);if(0>l&&0>h)for(l;-1>l;l++)n.push(s[--o]+--a);if(l>0&&0>h)for(l;l>1;l--)n.push(s[++o]+--a)}return n}return!1}function getMovementShape(t,e){var i=["","a","b","c","d","e","f","g","h",""],n=t[0],s=parseInt(t[1]),r=e[0],o=parseInt(e[1]),a=i.indexOf(r)-i.indexOf(n),l=o-s;return[a,l]}function getCellInDirection(t,e){var i=["","a","b","c","d","e","f","g","h",""],n=t[0],s=parseInt(t[1]);if("N"===e&&(s+=1),"S"===e&&(s-=1),"W"===e){var r=i.indexOf(n);r-=1,n=i[r]}if("E"===e){var r=i.indexOf(n);r+=1,n=i[r]}if("NE"===e){var r=i.indexOf(n);r+=1,n=i[r],s+=1}if("SE"===e){var r=i.indexOf(n);r+=1,n=i[r],s-=1}if("NW"===e){var r=i.indexOf(n);r-=1,n=i[r],s+=1}if("SW"===e){var r=i.indexOf(n);r-=1,n=i[r],s-=1}return""===n||1>s||s>8?"Out Of Bounds":n+""+s}function submitValue(){$("#pieceWindow").css("visibility","hidden");var t=$("#pieceSelect").val(),e=$("#pieceWindow").data("coords"),i=$("#pieceWindow").data("color");switch(t){case"Knight":$("#"+e)[0].innerHTML="♞",chessEngine.grid[e].content=new Knight(i);break;case"Bishop":$("#"+e)[0].innerHTML="♝",chessEngine.grid[e].content=new Bishop(i);break;case"Rook":$("#"+e)[0].innerHTML="♜",chessEngine.grid[e].content=new Rook(i);break;case"Queen":$("#"+e)[0].innerHTML="♛",chessEngine.grid[e].content=new Queen(i)}chessEngine.searchForCheck(),chessEngine.calculateLegalMoves(chessEngine.turn),chessEngine.pause=!1,chessEngine.whiteTurn?$("#wYourTurn").css("visibility","visible"):$("#bYourTurn").css("visibility","visible"),sendUpgrade(t,e,i)}function checkmate(t){var e;e="White"===t?"Black":"White",$("#wYourTurn").css("visibility","hidden"),$("#bYourTurn").css("visibility","hidden"),$("#gameBanner")[0].innerHTML="Checkmate: "+e+" wins."}function stalemate(){$("#wYourTurn").css("visibility","hidden"),$("#bYourTurn").css("visibility","hidden"),$("#gameBanner")[0].innerHTML="Stalemate: Its a draw."}function hideThemePicker(){$("#themePicker").css("visibility","hidden")}function changeTheme1(){var t=document.styleSheets[0];for(var e in t.cssRules)".black"===t.cssRules[e].selectorText&&(t.cssRules[e].style.color=$("#html5colorpicker1").val())}function changeTheme2(){var t=document.styleSheets[0];for(var e in t.cssRules)".white"===t.cssRules[e].selectorText&&(t.cssRules[e].style.color=$("#html5colorpicker2").val())}function changeTheme3(){var t=document.styleSheets[0];for(var e in t.cssRules)"#board"===t.cssRules[e].selectorText&&(t.cssRules[e].style.backgroundColor=$("#html5colorpicker3").val())}function changeTheme4(){var t=document.styleSheets[0];for(var e in t.cssRules)".light"===t.cssRules[e].selectorText&&(t.cssRules[e].style.backgroundColor=$("#html5colorpicker4").val())}function addMove(t,e,i){$(".moveList").append("<p>"+t+": "+e+" ~> "+i+"</p>")}function allowDrop(t){t.preventDefault()}function drag(t){t.dataTransfer.setData("piece",t.target.innerHTML),t.dataTransfer.setData("id",t.target.id),t.dataTransfer.setData("className",t.target.className)}function drop(t){t.preventDefault();var e=t.dataTransfer.getData("piece"),i=t.dataTransfer.getData("className"),n=t.dataTransfer.getData("id"),s=t.target.id,r=chessEngine.requestMove(n,s,!1);r&&(t.target.className=i,$("#"+n)[0].className="holder",$("#"+n)[0].innerHTML="",t.target.innerHTML=e,chessEngine.turnOver(n,s))}!function(t,e){var i=e(t);"object"==typeof module&&"object"==typeof exports?module.exports=i:("function"==typeof define?define("jqlite",function(){return i}):"function"==typeof angular?angular.module("jqlite",[]).constant("jqlite",i):t.jqlite=i,t.$||(t.$=i))}(this,function(t,e){function i(t){return function(e){return typeof e===t}}function n(t){return function(e){return e instanceof t}}function s(){for(var t,e=L.call(arguments),i=L.call(arguments);i;){if(typeof e!=typeof i&&(e=$(i)?[]:y(i)?{}:i),y(i))for(t in i)void 0!==i[t]&&(typeof e[t]!=typeof i[t]?e[t]=s(void 0,i[t]):$(e[t])?[].push.apply(e[t],i[t]):y(e[t])?e[t]=s(e[t],i[t]):e[t]=i[t]);i=L.call(arguments)}return e}function r(){for(var t,e=L.call(arguments),i=L.call(arguments);i;){for(t in i)e[t]=i[t];i=L.call(arguments)}return e}function o(t,e,i){if(void 0!==i){if(t.$jqListeners&&t.$jqListeners[e]){var n=S(t.$jqListeners[e],function(t){return t.srcListener===i});n.found&&(t.$jqListeners[e].splice(n.index,1),j(t,e,n.found))}}else if(t.$jqListeners&&t.$jqListeners[e]){for(var s=0,r=t.$jqListeners[e].length;r>s;s++)j(t,e,t.$jqListeners[e][s]);t.$jqListeners[e]=[]}}function a(t,e,i,n){var s=n?function(n){i.apply(t,[n].concat(n.args)),o(t,e,i)}:function(e){i.apply(t,[e].concat(e.args))};s.srcListener=i,t.$jqListeners=t.$jqListeners||{},t.$jqListeners[e]=t.$jqListeners[e]||[],t.$jqListeners[e].push(s),q(t,e,s)}function l(t,e){for(var i=0,n=e.length;n>i;i++)t[i]=e[i];return t.length+=n,t}function h(t,e){var i=t[0];if("<"===i){W.innerHTML=t;var n=l(new g,W.children);return n}if(-1!==t.indexOf(" ")||-1!==t.indexOf(":"))return l(new g,e.querySelectorAll(t));if("#"===i){var s=e.getElementById(t.substr(1));if(s){var r=new g;return r[0]=s,r.length=1,r}return l(new g,e.querySelectorAll(t))}return"."===i?l(new g,e.getElementsByClassName(t.substr(1))):I.test(t)?l(new g,e.getElementsByTagName(t)):l(new g,e.querySelectorAll(t))}function c(t){if(t instanceof g)return t;if($(t)||t instanceof NodeList||t instanceof HTMLCollection)return l(new g,t);if(t===window||t===document||t instanceof HTMLElement||t instanceof Element||T(t)){var e=new g;return e[0]=t,e.length=1,e}if(b(t))u(t);else if(void 0===t)return new g}function f(t,e){return w(t)?h(t,e||document):c(t)}function u(t){b(t)&&(/loaded|complete/.test(document.readyState)?t():P(t))}function g(){}function p(t){if(t.length<=1)return t;for(var e=t.filter(function(){return this.___found___?!1:(this.___found___=!0,!0)}),i=0,n=e.length;n>i;i++)delete e[i].___found___;return e}function v(t,e,i){return e&&(e.previousElementSibling&&(i=v(t,e.previousElementSibling,i)),t[i++]=e),i}function d(t,e,i,n,s){"string"==typeof i&&(i=d.times[i]),n=n||"linear";for(var r=e?0:1,o=e?1:0,a=0,l=t.length;l>a;a++)t[a].style.opacity=r;return setTimeout(function(){for(var e=0,s=t.length;s>e;e++)t[e].$jqliteTransition=void 0===t[e].$jqliteTransition?t[e].style[K]||"":t[e].$jqliteTransition,t[e].style[K]="opacity "+i+"ms "+n,t[e].style.opacity=o},20),setTimeout(function(){for(var e=0,i=t.length;i>e;e++)t[e].style.opacity="",t[e].style[K]=t[e].$jqliteTransition;s.call(t)},i),t}function m(t,e,i,n){var s,r;if("string"==typeof e)if(/\s/.test(e))e=e.split(/\s+/g);else{if(!b(i))throw"listener needs to be a function";for(s=0,r=t.length;r>s;s++)a(t[s],e,i,n)}if($(e))for(s=0,r=e.length;r>s;s++)m(t,e[s],i,n);else if(y(e))for(s in e)m(t,s,e[s],n);return t}var y=i("object"),b=i("function"),w=i("string"),E=i("number"),M=i("boolean"),$=Array.isArray||n(Array),C=n(Date),k=n(RegExp),T=function(t){return t&&1===t.nodeType},S=function(t,e){if(!(e instanceof Function)){var i=e;e=function(t){return t===i}}for(var n=0,s=t.length;s>n;n++)if(e(t[n]))return{index:n,found:t[n]};return{index:-1}},L=Array.prototype.shift;Element.prototype.matchesSelector||(Element.prototype.matchesSelector=Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector);var O=document.createEvent?function(t,e,i,n){var s=document.createEvent("HTMLEvents");return s.data=n,s.args=i,s.initEvent(e,!0,!0),t.dispatchEvent(s),s}:function(t,e,i,n){var s=document.createEventObject();return s.data=n,s.args=i,t.fireEvent("on"+e,s),s},x=eval,D=function(){},W=document.createElement("div"),B=document.createElement("div"),N=!!W.classList;if(!W.addEventListener&&!document.body.attachEvent)throw"Browser not compatible with element events";var q=W.addEventListener?function(t,e,i){return t.addEventListener(e,i,!1)}:function(t,e,i){return t.attachEvent("on"+e,i)},j=W.removeEventListener?function(t,e,i){return t.removeEventListener(e,i,!1)}:function(t,e,i){return t.detachEvent("on"+e,i)},I=/^[a-z-_]$/i;f.noop=D,f.extend=function(t){var e=[].slice.call(arguments);M(t)?e.shift():t=!1,t?s.apply(null,e):r.apply(null,e)},f.isObject=y,f.isFunction=b,f.isString=w,f.isNumber=E,f.isBoolean=M,f.isArray=$,f.isDate=C,f.isRegExp=k,f.isElement=T;var F=f,P=window.addEventListener?function(t){window.addEventListener("load",t,!1)}:function(t){window.attachEvent("onload",t)};g.prototype=[],g.prototype.ready=u,g.prototype.extend=function(t){var e=[].slice.call(arguments);M(t)?e.shift():t=!1,t?s.apply(null,[g.prototype].concat(e)):r.apply(null,[g.prototype].concat(e))},f.fn=g.prototype,g.prototype.get=function(t){return t?this[t]:this},g.prototype.eq=function(t){if(!E(t))throw"number required";var e=0>t?this[this.length-t]:this[t],i=new g;return e&&(i[0]=e,i.length=1),i},g.prototype.first=function(){var t=new g;return this.length&&(t[0]=this[0],t.length=1),t},g.prototype.last=function(){var t=new g;return this.length&&(t[0]=this[this.length-1],t.length=1),t},g.prototype.find=function(t){var e,i,n,s,r,o=this,a=new g,l=0;if(!t)return o;for(/^\s*>/.test(t)&&(t=t.replace(/^\s*>\s*([^\s]*)\s*/,function(t,e){return o=o.children(e),""})),e=0,n=o.length;n>e;e++)for(r=o[e].querySelectorAll(t),i=0,s=r.length;s>i;i++)a[l++]=r[i];return a.length=l,p(a)},g.prototype.$=g.prototype.find,g.prototype.add=function(t,e){var i,n,s=f(t,e),r=this.length,o=new g;for(i=0,n=this.length;n>i;i++)o[i]=this[i];for(i=0,n=s.length;n>i;i++)o[r++]=s[i];return o.length=r,p(o)},g.prototype.each=function(t){if(b(t))for(var e=0,i=this.length;i>e;e++)t.call(this[e],e,this[e]);return this},g.prototype.empty=function(){for(var t,e,i=0,n=this.length;n>i;i++)for(t=this[i],e=t.firstChild;e;)t.removeChild(e),e=t.firstChild;return this},g.prototype.filter=function(t){var e,i,n,s=new g;if(b(t))for(i=0,n=this.length,e;n>i;i++)e=this[i],t.call(e,i,e)&&s.push(e);else if(w(t))for(i=0,n=this.length,e;n>i;i++)e=this[i],Element.prototype.matchesSelector.call(e,t)&&s.push(e);return s};var A=W.closest?function(t,e){return t.closest(e)}:function(t,e){for(var i=t.parentElement;i;){if(i.matchesSelector(e))return i;i=i.parentElement}return null};g.prototype.closest=function(t){var e,i=new g,n=0;if(!t)return this;for(var s=0,r=this.length;r>s;s++)e=A(this[s],t),e&&(i[n++]=e);return i.length=n,p(i)},g.prototype.children=W.children?function(t){for(var e=new g,i=0,n=this.length;n>i;i++)l(e,this[i].children);return t?e.filter(t):e}:function(t){var e=new g;return Array.prototype.forEach.call(this,function(t){for(t=t.firstElementChild||t.firstChild;t;)e[e.length]=t,t=t.nextElementSibling||t.nextSibling}),t?e.filter(t):e},g.prototype.parent=function(t){for(var e=new g,i=0,n=0,s=this.length;s>n;n++)this[n].parentElement&&(e[i++]=this[n].parentElement);return e.length=i,p(t?e.filter(t):e)},g.prototype.contents=function(t){var e=new g;return Array.prototype.forEach.call(this,function(t){for(t=t.firstChild;t;)e[e.length]=t,t=t.nextSibling}),t?e.filter(t):e},g.prototype.clone=function(t,e){var i,n,s=new g;for(t=void 0===t||t,i=0,n=this.length;n>i;i++)s[i]=this[i].cloneNode(t);return s.length=n,s},g.prototype.data=function(t,e){if(!this.length)return e?this:void 0;if(void 0===e){var i=this[0].$jqliteData&&this[0].$jqliteData[t];return void 0===i?(i=this.dataset(t),void 0===i?void 0:"{"===i.charAt(0)||"["===i.charAt(0)?JSON.parse(i):/^\d+$/.test(i)?Number(i):i):i}for(var n=0,s=this.length;s>n;n++)this[n].$jqliteData=this[n].$jqliteData||{},this[n].$jqliteData[t]=e},g.prototype.removeData=function(t){for(var e=0,i=this.length;i>e;e++)this[e].$jqliteData&&this[e].$jqliteData[t]&&delete this[e].$jqliteData[t];return this},g.prototype.dataset=W.dataset?function(t,e){var i,n;if(void 0===e)return void 0===t?this[0]?this[0].dataset:{}:(this[0]||{}).dataset[t];for(i=0,n=this.length;n>i;i++)this[i].dataset[t]=e;return this}:function(t,e){var i,n;if(void 0===e){var s=[];for(i=0,n=this.length;n>i;i++)s.push(this[i].getAttribute("data-"+t));return(this[0]||{getAttribute:function(){return!1}}).getAttribute(t)}for(i=0,n=this.length;n>i;i++)this[i].setAttribute("data-"+t,e)},g.prototype.removeDataset=W.dataset?function(t){var e,i;if("string"==typeof t)for(e=0,i=this.length;i>e;e++)delete this[e].dataset[t];else if($(t))for(e=0,i=t.length;i>e;e++)this.removeData(t[e]);return this}:function(t){var e,i;if("string"==typeof t)for(e=0,i=this.length;i>e;e++)this[e].removeAttribute("data-"+t);else if($(t))for(e=0,i=t.length;i>e;e++)this.removeData(t[e]);return this},g.prototype.attr=function(t,e){var i,n;if(b(e))for(i=0,n=this.length;n>i;i++)this[i].setAttribute(t,e(i,this[i].getAttribute(t)));else if(void 0!==e)for(i=0,n=this.length;n>i;i++)this[i].setAttribute(t,e);else if(this[0])return this[0].getAttribute(t);return this},g.prototype.removeAttr=function(t){for(var e=0,i=this.length;i>e;e++)this[e].removeAttribute(t);return this},g.prototype.prop=function(t,e){var i,n;if(b(e))for(i=0,n=this.length;n>i;i++)this[i][t]=e(i,this[i][t]);else if(void 0!==e)for(i=0,n=this.length;n>i;i++)this[i][t]=e;else if(this[0])return this[0][t];return this},g.prototype.val=function(t){var e;if(void 0===t)return e=this[0],"select"===e.nodeName?e.options[e.selectedIndex].value:this[0].value||this[0].getAttribute("value");for(var i=0,n=this.length;n>i;i++)if("select"===this[i].nodeName){e=this[i];for(var s=0,r=e.options.length;r>s;s++)if(e.options[s].value===t){e.options[s].selected=!0;break}}else void 0!==this[i].value?this[i].value=t:this[i].setAttribute("value",t);return this},g.prototype.addClass=N?function(t){if(t.indexOf(" ")>=0){var e=this;t.split(" ").forEach(function(t){e.addClass(t)})}else for(var i=0,n=this.length;n>i;i++)this[i].classList.add(t);return this}:function(t){for(var e=new RegExp("\\b"+(t||"")+"\\b",""),i=0,n=this.length;n>i;i++)this[i].className=this[i].className.replace(e,"")+" "+t;return this},g.prototype.removeClass=N?function(t){if(t.indexOf(" ")>=0){var e=F(this);t.split(" ").forEach(function(t){e.removeClass(t)})}else for(var i=0,n=this.length;n>i;i++)this[i].classList.remove(t);return this}:function(t){for(var e=new RegExp("(\\b|\\s+)"+t+"\\b","g"),i=0,n=this.length;n>i;i++)this[i].className=this[i].className.replace(e,"");return this},g.prototype.hasClass=N?function(t){for(var e=0,i=this.length;i>e;e++)if(this[e].classList.contains(t))return!0;return!1}:function(t){for(var e=new RegExp("\\b"+(t||"")+"\\b",""),i=0,n=this.length;n>i;i++)if(e.test(this[i].className))return!0;return!1},g.prototype.toggleClass=N?function(t,e){var i,n;if(void 0===e)for(i=0,n=this.length;n>i;i++)this[i].classList.item(t)?this[i].classList.remove(t):this[i].classList.add(t);else if(e)for(i=0,n=this.length;n>i;i++)this[i].classList.add(t);else for(i=0,n=this.length;n>i;i++)this[i].classList.remove(t);return this}:function(t,e){var i,n,s=new RegExp("\\b"+(t||"")+"\\b",""),r=new RegExp("\\b"+(t||"")+"\\b",""),o=new RegExp("(\\b|\\s+)"+t+"\\b","g");if(void 0===t)for(i=0,n=this.length;n>i;i++)s.test(this[i].className)?this[i].className=this[i].className.replace(o,""):this[i].className=this[i].className.replace(r,"")+" "+t;else if(e)for(i=0,n=this.length;n>i;i++)this[i].className=this[i].className.replace(r,"")+" "+t;else for(i=0,n=this.length;n>i;i++)this[i].className=this[i].className.replace(o,"");return this},g.prototype.append=function(t){var e,i,n,s,r,o,a=F(t);for(a.remove(),i=0,s=this.length;s>i;i++)for(e=i?a.clone(!0):a,o=this[i],n=0,r=e.length;r>n;n++)o.appendChild(e[n]);return this},g.prototype.appendTo=function(t){F(t).append(this)},g.prototype.prepend=function(t){var e,i,n,s,r,o,a,l=F(t);for(l.remove(),i=0,s=this.length;s>i;i++)if(e=i?l.clone(!0):l,o=this[i],a=o.firstChild)for(n=0,r=e.length;r>n;n++)o.insertBefore(e[n],a);else for(n=0,r=e.length;r>n;n++)o.appendChild(e[n]);return this},g.prototype.after=function(t){var e,i,n,s,r,o,a,l=F(t);for(l.remove(),i=0,s=this.length;s>i;i++)if(e=i?l.clone(!0):l,a=this[i].parentElement||this[i].parentNode,o=this[i].nextElementSibling||this[i].nextSibling)for(n=0,r=e.length;r>n;n++)a.insertBefore(e[n],o),o=e[n];else for(n=0,r=e.length;r>n;n++)a.appendChild(e[n]);return this},g.prototype.replaceWith=function(t){var e,i,n,s,r,o,a,l=F(t);if(!l.length)return this;for(i=this.length-1;i>=0;i--)if(e=i?l.clone(!0):l,r=this[i],o=r.parentElement,o.replaceChild(e[0],r),e[1])if(a=e[0].nextElementSibling)for(n=1,s=e.length;s>n;n++)o.insertBefore(e[n],a);else for(n=1,s=e.length;s>n;n++)o.appendChild(e[n]);return this},g.prototype.wrap=function(t){var e=b(t)?function(e){return F(t(e))}:function(){var e=F(t),i=e.clone(!0);return function(t){return t?i.clone(!0):e}}();return this.each(function(t,i){for(var n=e(t)[0],s=this.parentElement,r=n;r.firstElementChild;)r=r.firstElementChild;s.replaceChild(n,this),r.appendChild(this)}),this},g.prototype.wrapAll=function(t){var e=F(b(t)?t():t)[0],i=this[0].parentElement;if(i.replaceChild(e,this[0]),e)for(;e.firstElementChild;)e=e.firstElementChild;for(var n=0,s=this.length;s>n;n++)e.appendChild(this[n]);return F(e)},g.prototype.unwrap=function(){for(var t,e=this.parent(),i=0,n=e.length;n>i;i++)t=e.eq(i),t.replaceWith(t.children());return this},g.prototype.next=function(t){for(var e,i=new g,n=0,s=0,r=this.length;r>s;s++)e=this[s].nextElementSibling,e&&(i[n++]=e);return i.length=n,"string"==typeof t?i.filter(t):i},g.prototype.nextAll=function(t){for(var e,i=new g,n=0,s=0,r=this.length;r>s;s++)for(e=this[s].nextElementSibling;e;)i[n++]=e,e=e.nextElementSibling;return i.length=n,p(t?i.filter(t):i)},g.prototype.prev=function(t){for(var e,i=new g,n=0,s=0,r=this.length;r>s;s++)e=this[s].previousElementSibling,e&&(i[n++]=e);return i.length=n,t?i.filter(t):i},g.prototype.prevAll=function(t){for(var e=new g,i=0,n=0,s=this.length;s>n;n++)i=v(e,this[n].previousElementSibling,i);return e.length=i,p(t?e.filter(t):e)},g.prototype.remove=function(t){for(var e,i=t?this.filter(t):this,n=0,s=i.length;s>n;n++)e=i[n].parentElement||i[n].parentNode,e&&e.removeChild(i[n]);return this},g.prototype.detach=function(t){for(var e=t?this.filter(t):this,i=new g,n=0,s=e.length;s>n;n++)B.appendChild(e[n]),i.push(e[n]);return i},g.prototype.css=function(t,e){if(void 0!==e){var i,n;if(e=e instanceof Function?e():e instanceof Number?e+"px":e,"string"==typeof e&&/^\+=|\-=/.test(e))for(e="-"===e.charAt(0)?-parseFloat(e.substr(2)):parseFloat(e.substr(2)),i=0,n=this.length;n>i;i++)this[i].style[t]=parseFloat(this[i].style[t])+e+"px";else for(i=0,n=this.length;n>i;i++)this[i].style[t]=e;return this}if(t instanceof Object)for(var s in t)this.css(s,t[s]);else if(this[0])return this[0].style[t]||window.getComputedStyle(this[0])[t];return this};var K=void 0!==W.style.webkitTransition?"webkitTransition":void 0!==W.style.mozTransition?"mozTransition":void 0!==W.style.msTransition?"msTransition":void 0;d.times={slow:600,normal:400,fast:200},g.prototype.show=function(t,e,i){if(t){var n=this;return this.show(),d(n,!0,t,e,i||function(){})}for(var s=0,r=this.length;r>s;s++)this[s].style.display&&(this[s].style.display="");return this},g.prototype.hide=function(t,e,i){if(t)return d(this,!1,t,e,function(){this.hide(),i&&i.call(this)});for(var n=0,s=this.length;s>n;n++)this[n].style.display="none";return this},g.prototype.position=function(){return this.length?{top:this[0].offsetTop,left:this[0].offsetLeft}:void 0},g.prototype.offset=function(t){if(void 0===t){var e=this[0].getBoundingClientRect();return this.length&&{top:e.top+document.body.scrollTop,left:e.left}}if(t instanceof Function&&(t=t()),"object"==typeof t&&void 0!==t.top&&void 0!==t.left){for(var i=0,n=this.length;n>i;i++){this[i].style.position="relative";var s=this[i].getBoundingClientRect();this[i].style.top=t.top-s.top+parseFloat(this[i].style.top||0)-document.body.scrollTop+"px",this[i].style.left=t.left-s.left+parseFloat(this[i].style.left||0)+"px"}return t}},g.prototype.width=function(t,e){var i;if(t===!0){if(this.length)return i=this[0],i.offsetWidth}else if(void 0!==t)for(var n=0,s=this.length;s>n;n++)this[n].style.width=t;else if(this.length)return i=this[0],i.offsetWidth-parseFloat(window.getComputedStyle(i,null).getPropertyValue("border-left-width"))-parseFloat(window.getComputedStyle(i,null).getPropertyValue("padding-left"))-parseFloat(window.getComputedStyle(i,null).getPropertyValue("padding-right"))-parseFloat(window.getComputedStyle(i,null).getPropertyValue("border-right-width"))},g.prototype.height=function(t,e){var i;if(t===!0){if(this.length)return i=this[0],i.offsetHeight}else if(void 0!==t)for(var n=0,s=this.length;s>n;n++)this[n].style.height=t;else if(this.length)return i=this[0],i.offsetHeight-parseFloat(window.getComputedStyle(i,null).getPropertyValue("border-top-width"))-parseFloat(window.getComputedStyle(i,null).getPropertyValue("padding-top"))-parseFloat(window.getComputedStyle(i,null).getPropertyValue("padding-bottom"))-parseFloat(window.getComputedStyle(i,null).getPropertyValue("border-bottom-width"))},g.prototype.html=function(t){var e,i;if(void 0===t){for(t="",e=0,i=this.length;i>e;e++)t+=this[e].innerHTML;return t}if(t===!0){for(t="",e=0,i=this.length;i>e;e++)t+=this[e].outerHTML;return t}if(b(t)){for(e=0,i=this.length;i>e;e++)this[e].innerHTML=t(e,this[e].innerHTML);return this}for(e=0,i=this.length;i>e;e++)this[e].innerHTML=t;return this.find("script").each(function(){if(("text/javascript"==this.type||!this.type)&&this.textContent)try{x("(function(){ 'use strict';"+this.textContent+"})();")}catch(t){throw new Error(t.message)}}),this},g.prototype.text=function(t){var e,i;if(void 0===t){for(t="",e=0,i=this.length;i>e;e++)t+=this[e].textContent;return t}if(b(t)){for(e=0,i=this.length;i>e;e++)this[e].textContent=t(e,this[e].textContent);return this}for(e=0,i=this.length;i>e;e++)this[e].textContent=t;return this},g.prototype.on=function(t,e){return m(this,t,e)};var R={list:["click","focus","blur","submit"],define:function(t){g.prototype[t]=function(e){if(e)this.on(t,e);else for(var i=0,n=this.length;n>i;i++)this[i][t]();return this}},init:function(){for(var t=0,e=R.list.length;e>t;t++)R.define(R.list[t])}};return R.init(),g.prototype.once=function(t,e){return m(this,t,e,!0)},g.prototype.one=g.prototype.once,g.prototype.off=function(t,e){var i,n;if(/\s/.test(t)&&(t=t.split(/\s+/g)),t instanceof Array){for(i=0,n=this.length;n>i;i++)this.off(t[i],e);return this}if(void 0===t){var s,r;for(i=0,n=this.length;n>i;i++){s=this[i].$jqListeners||{};for(r in s)o(this[i],r),delete s[r]}}else if("string"!=typeof t||!b(e)&&void 0!==e)throw"bad arguments";for(i=0,n=this.length;n>i;i++)o(this[i],t,e);return this},g.prototype.trigger=function(t,e,i){if("string"!=typeof t)throw"bad arguments";for(var n=0,s=this.length;s>n;n++)O(this[n],t,e,i);return this},g.prototype.stopPropagation=function(){for(var t=0,e=arguments.length;e>t;t++)this.on(arguments[t],function(t){t.stopPropagation()})},["mouseenter","mouseleave"].forEach(function(t){g.prototype[t]=function(e){return this.on(t,e),this}}),g.prototype.hover=function(t,e){return this.mouseenter(t).mouseleave(e)},f.noConflict=function(){return t.$===f&&delete t.$,f},f});class Piece{constructor(t){this.color=t;this.moved=false;this.legalMoves=[];this.symbol=""}makeMove(t,e){chessEngine.grid[e].content=chessEngine.grid[t].content;chessEngine.grid[t].content=null;addMove(this.printName(),t,e)}printName(){return this.color[0]+this.symbol}}class Pawn extends Piece{constructor(t){super(t);this.value=1;this.symbol="P";this.attackMoves=[]}calculateLegalMoves(t){var e=chessEngine.grid;this.legalMoves=[];if(this.color==="White"){var i=getCellInDirection(t,"N");var n=getCellInDirection(t,"NE");var s=getCellInDirection(t,"NW");if(!this.moved){var r=getCellInDirection(i,"N");if(e[i].isEmpty()&&e[r].isEmpty()){this.legalMoves.push(t+","+r)}}if(i!=="Out Of Bounds"){if(e[i].isEmpty()){this.legalMoves.push(t+","+i)}}if(n!=="Out Of Bounds"){if(e[n].hasOpponent()||e[n].hasFlag("Black")){this.legalMoves.push(t+","+n)}}if(s!=="Out Of Bounds"){if(e[s].hasOpponent()||e[s].hasFlag("Black")){this.legalMoves.push(t+","+s)}}}else{var o=getCellInDirection(t,"S");var a=getCellInDirection(t,"SE");var l=getCellInDirection(t,"SW");if(!this.moved){var h=getCellInDirection(o,"S");if(e[o].isEmpty()&&e[h].isEmpty()){this.legalMoves.push(t+","+h)}}if(i!=="Out Of Bounds"){if(e[o].isEmpty()){this.legalMoves.push(t+","+o)}}if(a!=="Out Of Bounds"){if(e[a].hasOpponent()||e[a].hasFlag("White")){this.legalMoves.push(t+","+a)}}if(l!=="Out Of Bounds"){if(e[l].hasOpponent()||e[l].hasFlag("White")){this.legalMoves.push(t+","+l)}}}}canSeeKing(t,e){var i=chessEngine.grid;this.attackMoves=[];if(this.color==="White"){var n=getCellInDirection(t,"NE");var s=getCellInDirection(t,"NW");if(n!=="Out Of Bounds"){if(i[n].hasOpponent()||i[n].hasFlag("Black")){this.attackMoves.push(t+","+n)}}if(s!=="Out Of Bounds"){if(i[s].hasOpponent()||i[s].hasFlag("Black")){this.attackMoves.push(t+","+s)}}}else{var r=getCellInDirection(t,"SE");var o=getCellInDirection(t,"SW");if(r!=="Out Of Bounds"){if(i[r].hasOpponent()||i[r].hasFlag("White")){this.attackMoves.push(t+","+r)}}if(o!=="Out Of Bounds"){if(i[o].hasOpponent()||i[o].hasFlag("White")){this.attackMoves.push(t+","+o)}}}for(var a in this.attackMoves){var l=this.attackMoves[a].split(",")[1];if(l===e){return true}}return false}makeMove(t,e){var i;var n=getMovementShape(t,e);if(n[1]===2||n[1]===-2){if(n[1]===2){i=getCellInDirection(t,"N")}if(n[1]===-2){i=getCellInDirection(t,"S")}chessEngine.grid[i].setFlag(this.color)}var s;if(this.color==="White"){s="Black"}else{s="White"}if(chessEngine.grid[e].hasFlag(s)){if(n[1]===1){i=getCellInDirection(e,"S")}if(n[1]===-1){i=getCellInDirection(e,"N")}chessEngine.grid[i].content=null;$("#"+i)[0].innerHTML=""}super.makeMove(t,e)}}class Rook extends Piece{constructor(t){super(t);this.value=5;this.symbol="R"}calculateLegalMoves(t){var e=[];var i;var n=t;var s=["N","E","S","W"];for(var r=0;r<4;r++){n=t;for(var o=1;o<8;o++){i=getCellInDirection(n,s[r]);if(i==="Out Of Bounds"){n=t;break}var a=chessEngine.grid[i];if(a.hasTeammate(this.color)){n=t;break}if(a.hasOpponent(this.color)){e.push(t+","+i);n=t;break}e.push(t+","+i);n=i}}this.legalMoves=e}canSeeKing(t,e){this.calculateLegalMoves(t);for(var i in this.legalMoves){var n=this.legalMoves[i].split(",")[1];if(n===e){return true}}return false}}class Knight extends Piece{constructor(t){super(t);this.possibleMoves=["2,1","1,2","2,-1","-1,2","-2,1","1,-2","-2,-1","-1,-2"];this.possibleDestinations;this.value=3;this.symbol="N"}buildMoveList(t,e){var i=["","a","b","c","d","e","f","g","h",""];var n=[];var s=i.indexOf(e[0]);var r=parseInt(e[1]);for(var o in this.possibleMoves){var a=parseInt(this.possibleMoves[o].split(",")[0]);var l=parseInt(this.possibleMoves[o].split(",")[1]);var h=s+a;var c=r+l;if(h<1||h>8||c<1||c>8){}else{n.push(i[h]+c)}}this.possibleDestinations=n}calculateLegalMoves(t){this.legalMoves=[];this.buildMoveList(chessEngine.grid,t);for(var e in this.possibleDestinations){if(chessEngine.grid[this.possibleDestinations[e]].hasOpponent(this.color)){this.legalMoves.push(t+","+this.possibleDestinations[e])}if(chessEngine.grid[this.possibleDestinations[e]].isEmpty()){this.legalMoves.push(t+","+this.possibleDestinations[e])}}}canSeeKing(t,e){this.calculateLegalMoves(t);for(var i in this.legalMoves){var n=this.legalMoves[i].split(",")[1];if(n===e){return true}}return false}}class Bishop extends Piece{constructor(t){super(t);this.value=3;this.possibleDestinations=[];this.symbol="B"}calculateLegalMoves(t){var e=[];var i;var n=t;var s=["NW","NE","SE","SW"];for(var r=0;r<4;r++){n=t;for(var o=1;o<8;o++){i=getCellInDirection(n,s[r]);if(i==="Out Of Bounds"){n=t;break}var a=chessEngine.grid[i];if(a.hasTeammate(this.color)){n=t;break}if(a.hasOpponent(this.color)){e.push(t+","+i);n=t;break}e.push(t+","+i);n=i}}this.legalMoves=e}canSeeKing(t,e){this.calculateLegalMoves(t);for(var i in this.legalMoves){var n=this.legalMoves[i].split(",")[1];if(n===e){return true}}return false}}class King extends Piece{constructor(t){super(t);this.value=0;this.symbol="K"}calculateLegalMoves(t,e){var i=true;var n=true;this.legalMoves=[];var s=t[1];var r;if(this.color==="White"){r="Black"}else{r="White"}for(var o in chessEngine.grid){if(chessEngine.grid[o].content){if(chessEngine.grid[o].content.color===r){if(chessEngine.grid[o].content.canSeeKing(o,"f"+s)){n=false}if(chessEngine.grid[o].content.canSeeKing(o,"d"+s)){i=false}}}}if(!this.moved&&chessEngine.check!==this.color){var a=chessEngine.grid["a"+s];var l=chessEngine.grid["b"+s];var h=chessEngine.grid["c"+s];var c=chessEngine.grid["d"+s];var f=chessEngine.grid["f"+s];var u=chessEngine.grid["g"+s];var g=chessEngine.grid["h"+s];if(a.content&&i){if(a.content instanceof Rook){if(!a.content.moved){if(l.isEmpty()&&h.isEmpty()&&c.isEmpty()){this.legalMoves.push(t+","+"c"+s)}}}}if(g.content&&n){if(g.content instanceof Rook){if(!g.content.moved){if(f.isEmpty()&&u.isEmpty()){this.legalMoves.push(t+","+"g"+s)}}}}}var p;var v;var d=["W","NW","N","NE","E","SE","S","SW"];for(var m=0;m<8;m++){var y=true;p=getCellInDirection(t,d[m]);if(p==="Out Of Bounds"){continue}v=chessEngine.grid[p];if(v.hasOpponent(this.color)||v.isEmpty()){if(this.color==="White"){if(e){for(var o in chessEngine.legalMoves["Black"]){if(chessEngine.legalMoves["Black"][o].split(",")[1]===p){y=false}}}}else{if(e){for(var o in chessEngine.legalMoves["White"]){if(chessEngine.legalMoves["White"][o].split(",")[1]===p){y=false}}}}if(y){this.legalMoves.push(t+","+p)}}}}canSeeKing(t,e){return false}makeMove(t,e){var i;var n;var s=getMovementShape(t,e);if(s[0]===2||s[0]===-2){if(s[0]===2){i=getCellInDirection(e,"E");n=getCellInDirection(e,"W")}if(s[0]===-2){i=getCellInDirection(e,"W");i=getCellInDirection(i,"W");n=getCellInDirection(e,"E")}chessEngine.grid[n].content=chessEngine.grid[i].content;chessEngine.grid[i].content=null;chessEngine.grid[n].content.moved=true;$("#"+i)[0].innerHTML="";$("#"+n)[0].innerHTML="♜";$("#"+n)[0].className="holder "+this.color.toLowerCase()}super.makeMove(t,e)}}class Queen extends Piece{constructor(t){super(t);this.value=9;this.possibleDestinations=[];this.symbol="Q"}calculateLegalMoves(t){var e=[];var i;var n=t;var s=["W","NW","N","NE","E","SE","S","SW"];for(var r=0;r<8;r++){n=t;for(var o=1;o<8;o++){i=getCellInDirection(n,s[r]);if(i==="Out Of Bounds"){n=t;break}var a=chessEngine.grid[i];if(a.hasTeammate(this.color)){n=t;break}if(a.hasOpponent(this.color)){e.push(t+","+i);n=t;break}e.push(t+","+i);n=i}}this.legalMoves=e}canSeeKing(t,e){this.calculateLegalMoves(t);for(var i in this.legalMoves){var n=this.legalMoves[i].split(",")[1];if(n===e){return true}}return false;
}}class Square{constructor(t){this.content=t;this.enPassantFlag=false}acceptPiece(t){this.content=t}removePiece(){this.content=null}setFlag(t){this.enPassantFlag=t}removeFlag(){this.enPassantFlag=false}hasPiece(){if(this.content){return true}else{return false}}hasFlag(t){if(this.enPassantFlag===t){return true}else{return false}}hasTeammate(t){if(this.content){if(this.content.color===t){return true}}return false}hasOpponent(t){if(this.content){if(this.content.color!==t){return true}}return false}isEmpty(){if(!this.content){return true}else{return false}}}var playerColor,coordMap=[],letters=["","a","b","c","d","e","f","g","h"],positions={a2:"w♟1",b2:"w♟2",c2:"w♟3",d2:"w♟4",e2:"w♟5",f2:"w♟6",g2:"w♟7",h2:"w♟8",a1:"w♜1",b1:"w♞1",c1:"w♝1",d1:"w♛",e1:"w♚",f1:"w♝2",g1:"w♞2",h1:"w♜2",a7:"b♟1",b7:"b♟2",c7:"b♟3",d7:"b♟4",e7:"b♟5",f7:"b♟6",g7:"b♟7",h7:"b♟8",a8:"b♜1",b8:"b♞1",c8:"b♝1",d8:"b♛",e8:"b♚",f8:"b♝2",g8:"b♞2",h8:"b♜2"};class ChessEngine{constructor(){this.grid={};this.turn="White";this.waiting="Black";this.blackKing="e8";this.whiteKing="e1";this.pause=false;this.check=false;this.lastMove=null;this.legalMoves={};this.legalMoves["White"]=[];this.legalMoves["Black"]=[]}initializeGrid(){for(var t=1;t<9;t++){for(var e=1;e<9;e++){this.grid[mapToLetter(e)+t]=new Square(idToPiece(positions[mapToLetter(e)+t]))}}this.updatePoints();this.calculateLegalMoves(this.turn,true)}showGrid(){var t=0;var e=0;var i="";var n="";for(var s in this.grid){n+="|";if(this.grid[s].content){if(this.grid[s].content.symbol){n+=this.grid[s].content.color[0]+this.grid[s].content.symbol}else{n+="  "}}else{n+="  "}t++;if(t==8){t=0;n+="|\n";i=++e+" "+n+"---------------------------\n"+i;n=""}}i+="----A--B--C--D--E--F--G--H-";console.log(i)}requestMove(t,e,i){if(!i&&!(this.turn==playerColor)){return false}if(this.pause){return false}if(this.grid[t]){if(this.grid[t].hasOpponent(this.turn)){return false}}if(this.legalMoves[this.turn].indexOf(t+","+e)>=0){return true}else{return false}}removePassants(t){for(var e in this.grid){if(this.grid[e].hasFlag(t)){this.grid[e].removeFlag()}}}changeHighlighting(t,e){if(this.lastMove){var i=this.lastMove[0];var n=this.lastMove[1];$("#"+i).removeClass("glow");$("#"+n).removeClass("glow")}this.lastMove=[t,e];$("#"+t).addClass("glow");$("#"+e).addClass("glow")}upgradePawnCheck(){this.pause=true;var t=["a1","b1","c1","d1","e1","f1","g1","h1","a8","b8","c8","d8","e8","f8","g8","h8"];for(var e in t){var i=this.grid[t[e]].content;if(i instanceof Pawn){if(i.color===playerColor){$("#pieceWindow").css("visibility","visible")}$("#wYourTurn").css("visibility","hidden");$("#bYourTurn").css("visibility","hidden");$("#pieceWindow").data("coords",t[e]);$("#pieceWindow").data("color",i.color);return}}this.pause=false}updatePoints(){var t=0;var e=0;for(var i in this.grid){if(this.grid[i].content){if(this.grid[i].content.color==="Black"){t+=this.grid[i].content.value}if(this.grid[i].content.color==="White"){e+=this.grid[i].content.value}}}$("#bPieceValue")[0].innerHTML=t;$("#wPieceValue")[0].innerHTML=e}calculateLegalMoves(t){this.legalMoves[t]=[];for(var e in this.grid){if(this.grid[e].content){var i=this.grid[e].content;if(i.color===t){i.calculateLegalMoves(e);for(var n in i.legalMoves){if(this.analyzeMoveForLegality(i.legalMoves[n])){this.legalMoves[t].push(i.legalMoves[n])}}}}}if(this.legalMoves[t].length===0){this.searchForCheck();if(this.check===t){checkmate(t)}else{stalemate()}}console.log(this.turn.toUpperCase()+"'s turn, legal moves: ",this.legalMoves[t])}searchForCheck(){var t=false;var e;if(this.turn==="Black"){e=this.blackKing}else{e=this.whiteKing}for(var i in this.grid){if(this.grid[i].content){if(this.grid[i].content.color===this.waiting){if(this.grid[i].content.canSeeKing(i,e)){t=true}}}}if(this.turn==="Black"&&t){$("#"+this.blackKing).addClass("check");$("#"+this.whiteKing).removeClass("check");this.check="Black";return}if(this.turn==="White"&&t){$("#"+this.whiteKing).addClass("check");$("#"+this.blackKing).removeClass("check");this.check="White";return}$("#"+this.whiteKing).removeClass("check");$("#"+this.blackKing).removeClass("check");this.check=false}analyzeMoveForLegality(t){var e=true;var i=t.split(",")[0];var n=t.split(",")[1];var s=this.grid[i].content;var r=this.grid[n].content;if(s instanceof King&&s.color===this.turn){if(this.turn==="White"){this.whiteKing=n}else{this.blackKing=n}}this.grid[i].content=null;this.grid[n].content=s;if(this.turn==="White"){e=!this.isKingInSight(this.grid,this.whiteKing)}else{e=!this.isKingInSight(this.grid,this.blackKing)}if(s instanceof King&&s.color===this.turn){if(this.turn==="White"){this.whiteKing=i}else{this.blackKing=i}}this.grid[i].content=s;this.grid[n].content=r;return e}isKingInSight(t,e){var i=false;for(var n in t){if(t[n].content){if(t[n].content.color===this.waiting){if(t[n].content.canSeeKing(n,e)){i=true}}}}return i}turnOver(t,e){if(this.grid[t].content instanceof King){if(this.turn==="White"){this.whiteKing=e}else{this.blackKing=e}}this.grid[t].content.makeMove(t,e);this.upgradePawnCheck();this.updatePoints();this.grid[e].content.moved=true;this.changeHighlighting(t,e);if(this.turn==="White"){this.turn="Black";this.waiting="White";$("#wYourTurn").css("visibility","hidden");$("#bYourTurn").css("visibility","visible")}else{this.turn="White";this.waiting="Black";$("#wYourTurn").css("visibility","visible");$("#bYourTurn").css("visibility","hidden")}this.removePassants(this.turn);this.searchForCheck();this.calculateLegalMoves(this.turn);sendMove(t,e)}}var chessEngine=new ChessEngine;chessEngine.initializeGrid(),initializeMapping(),initializeBoard();var cellholders=$(".holder");for(var i in cellholders)64>i&&(cellholders[i].draggable=!0,cellholders[i].ondrop=drop,cellholders[i].ondragover=allowDrop,cellholders[i].ondragstart=drag);</script>
		<script src="http://192.168.2.4:3000/socket.io/socket.io.js"></script>
		<script>
		  var socket = io("192.168.2.4:3000");
		  socket.on('showColorDisplay', function(){
		  	$('#colorDisplay').css('visibility', 'visible');
		  });
		  socket.on('sendColor', function(color){
		  	$('#secondaryDisplay').css('visibility', 'visible');
		  	$('#givenColor').html(color);
		  	$('#givenColor').css('color', color.toLowerCase())
		  	playerColor = color;
		  	$('#offerDraw' + color).css('visibility', 'visible');
		  });
		  function requestColor(color){
		  	socket.emit('requestColor', color);
		  	playerColor = color;
		  	$('#offerDraw' + color).css('visibility', 'visible');
		  	$('#colorDisplay').css('visibility', 'hidden');
		  }
		  function sendMove(origin, destination){
		  	socket.emit('sendMove', origin + "," + destination);
		  }
		  socket.on('broadcastMove', function(move){
		  	var origin = move.split(',')[0];
		  	var destination = move.split(',')[1];
		  	var response = chessEngine.requestMove(origin, destination, true);
		  	if (response){
		  		$('#' + destination)[0].className = $('#' + origin)[0].className
		  		$('#' + origin)[0].className = 'holder';
		  		$('#' + destination)[0].innerHTML = $('#' + origin)[0].innerHTML
		  		$('#' + origin)[0].innerHTML = '';
		  		chessEngine.turnOver(origin, destination);
		  	}
		  });
		  function sendUpgrade(selection, coords, color){
		  	socket.emit('sendUpgrade', {
		  		selection: selection,
		  		coords: coords,
		  		color: color
		  	});
		  }
		  socket.on('broadcastUpgrade', function(data){
		  	var selection = data.selection;
		  	var coords = data.coords;
		  	var color = data.color;
		  	switch(selection){
		  		case 'Knight':
		  			$('#' + coords)[0].innerHTML = "♞"
		  			chessEngine.grid[coords].content = new Knight(color);
		  			break;
		  		case 'Bishop':
		  			$('#' + coords)[0].innerHTML = "♝"
		  			chessEngine.grid[coords].content = new Bishop(color);
		  			break;
		  		case 'Rook':
		  			$('#' + coords)[0].innerHTML = "♜"
		  			chessEngine.grid[coords].content = new Rook(color);
		  			break;
		  		case 'Queen':
		  			$('#' + coords)[0].innerHTML = "♛"
		  			chessEngine.grid[coords].content = new Queen(color);
		  			break;
		  	}
		  	chessEngine.searchForCheck();
		  	chessEngine.calculateLegalMoves(chessEngine.turn);
		  	chessEngine.pause = false;
		  	if(chessEngine.whiteTurn){
		  		$('#wYourTurn').css("visibility", "visible");
		  	} else {
		  		$('#bYourTurn').css("visibility", "visible");
		  	}
		  })
		  function sendDrawOffer(){
		  	socket.emit('drawOffer');
		  }
		  socket.on('drawOffered', function(){
		  	$('#drawOffer').css("visibility", "visible");
		  });
		  function acceptOffer(){
		  	$('#drawOffer').css("visibility", "hidden");
		  	$('#gameBanner')[0].innerHTML = "Gameover: Mutual draw."
		  	socket.emit('acceptOffer');
		  }
		  function declineOffer(){
		  	$('#drawOffer').css("visibility", "hidden");
		  	socket.emit('declineOffer');
		  }
		  socket.on('offerDeclined', function(){
		  	$('#resultText')[0].innerHTML = "Your offer was declined";
		  	$('#offerResults').css('visibility', 'visible');
		  })
		  socket.on('offerAccepted', function(){
		  	$('#resultText')[0].innerHTML = "The game has ended in mutual draw";
		  	$('#gameBanner')[0].innerHTML = "Gameover: Mutual draw."
		  	$('#offerResults').css('visibility', 'visible');
		  })
		</script>
  	</body>
</html>